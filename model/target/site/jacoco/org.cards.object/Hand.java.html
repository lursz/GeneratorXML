<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Hand.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">poker-model</a> &gt; <a href="index.source.html" class="el_package">org.cards.object</a> &gt; <span class="el_source">Hand.java</span></div><h1>Hand.java</h1><pre class="source lang-java linenums">package org.cards.object;
import org.cards.object.Deck;

import java.util.*;
import java.util.stream.IntStream;

/**
 *Class managing Hand functions
 */
public class Hand {
    private ArrayList&lt;Card&gt; hand_;
    private int numberOfCards_;



    /* -------------------------------------------------------------------------- */
    /*                                 Constructor                                */
    /* -------------------------------------------------------------------------- */

    /**
     * Constructor
     */
<span class="fc" id="L23">    public Hand() {</span>
<span class="fc" id="L24">        this.hand_ = new ArrayList&lt;Card&gt;();</span>
<span class="fc" id="L25">        this.numberOfCards_ = 0;</span>
<span class="fc" id="L26">    }</span>


    /* -------------------------------------------------------------------------- */
    /*                                   Getters                                  */
    /* -------------------------------------------------------------------------- */

    public ArrayList&lt;Card&gt; getHand_() {
<span class="nc" id="L34">        return hand_;</span>
    }

    public int getNumberOfCards() {
<span class="fc" id="L38">        return numberOfCards_;</span>
    }

    /**
     *
     * @param index
     * @return index
     */
    public Card getCard(int index) {
<span class="fc" id="L47">        return hand_.get(index);</span>
    }

    @Override
    public String toString() {
<span class="fc" id="L52">        sortHand(this);</span>
<span class="fc" id="L53">        StringBuilder sb = new StringBuilder();</span>
<span class="fc" id="L54">        sb.append(&quot;\n&quot;);</span>
<span class="fc bfc" id="L55" title="All 2 branches covered.">        for (int i = 0; i &lt; hand_.size(); i++) {</span>
<span class="fc" id="L56">            sb.append(&quot;(&quot;).append(i).append(&quot;)&quot;).append(hand_.get(i).getRank().toString()).append(&quot; of &quot;).append(hand_.get(i).getSuit().toString()).append(&quot;\n&quot;);</span>
//            sb.append(&quot;(&quot;+i+&quot;)&quot;+ hand_.get(i).getRank().toString() + &quot; of &quot; + hand_.get(i).getSuit().toString() + &quot;\n&quot;);

        }
<span class="fc" id="L60">        return sb.toString();</span>
    }
    /* -------------------------------------------------------------------------- */
    /*                                   Methods                                  */
    /* -------------------------------------------------------------------------- */

    /* ------------------------------- Manage hand ------------------------------ */
    public void addCard(Card card) {
<span class="fc" id="L68">        hand_.add(card);</span>
<span class="fc" id="L69">        numberOfCards_++;</span>

<span class="fc" id="L71">    }</span>

    public void removeCard(Card card) {
<span class="nc" id="L74">        hand_.remove(card);</span>
<span class="nc" id="L75">        numberOfCards_--;</span>
<span class="nc" id="L76">    }</span>

    public void removeCard(int index) {
<span class="fc" id="L79">        hand_.remove(index);</span>
<span class="fc" id="L80">        numberOfCards_--;</span>
<span class="fc" id="L81">    }</span>

    public void clearHand() {
<span class="nc" id="L84">        hand_.clear();</span>
<span class="nc" id="L85">        numberOfCards_ = 0;</span>
<span class="nc" id="L86">    }</span>

    /**
     * Function used to let go of cards in hand, and collect cards from deck
     * @param indexOfCardsToExchange
     * @param deck
     */
    public void exchangeCards(int[] indexOfCardsToExchange, Deck deck) {
<span class="nc bnc" id="L94" title="All 2 branches missed.">        for (int i = 0; i &lt; indexOfCardsToExchange.length; i++) {</span>
<span class="nc" id="L95">            hand_.set(indexOfCardsToExchange[i], deck.draw());</span>
        }
<span class="nc" id="L97">    }</span>

    /* -------------------------------------------------------------------------- */
    /*                               Hand Management                              */
    /* -------------------------------------------------------------------------- */
    /* -------- Static multiple cards arrays for deciding cards seniority ------- */
<span class="fc" id="L103">    static int[] pairArray = new int[]{2, 1, 1, 1, 0};</span>
<span class="fc" id="L104">    static int[] twoPairsArray = new int[]{2, 2, 1, 0, 0};</span>
<span class="fc" id="L105">    static int[] threeSameArray = new int[]{3, 1, 1, 0, 0};</span>
<span class="fc" id="L106">    static int[] fullHouseArray = new int[]{3, 2, 0, 0, 0};</span>
<span class="fc" id="L107">    static int[] fourSameArray = new int[]{4, 1, 0, 0, 0};</span>

    /* --------------------------- Seniority constants -------------------------- */
<span class="fc" id="L110">    static int noSeniority = 0;</span>
<span class="fc" id="L111">    static int pairSeniority = 1;</span>
<span class="fc" id="L112">    static int twoPairsSeniority = 2;</span>
<span class="fc" id="L113">    static int threeOfTheKindSeniority = 3;</span>
<span class="fc" id="L114">    static int straightSeniority = 4;</span>
<span class="fc" id="L115">    static int flushSeniority = 5;</span>
<span class="fc" id="L116">    static int fullHouseSeniority = 6;</span>
<span class="fc" id="L117">    static int fourOfTheKindSeniority = 7;</span>

    // flushSeniority (5) + straightSeniority (4) = Straight Flush (9)
<span class="fc" id="L120">    static int[] noMultipleCardsSeniorities = new int[]{0, 4, 5, 9};</span>



/* ------------------- Ultimate hand comparison function -------------------- */

    /**
     * Ultimate comparison function
     * Looks for the highest card (Cards ought to already be sorted)
     *         Loops through the hand and returns:
     *         -&gt; 1:   if this hand has the highest card
     *         -&gt; -1:  if the other hand has the highest card
     *         -&gt; 0:   if they are equal
     * @param other
     * @return
     */
    public int isBetterThan(Hand other) {
        // 1 -&gt; this hand is better than the other
        // 0 -&gt; hands are equal
        // -1 -&gt; this hand is worse than the other

<span class="fc" id="L141">        sortHand(this);</span>
<span class="fc" id="L142">        sortHand(other);</span>
<span class="fc" id="L143">        int thisSeniority = this.handSeniority();</span>
<span class="fc" id="L144">        int otherSeniority = other.handSeniority();</span>

<span class="fc bfc" id="L146" title="All 2 branches covered.">        if (thisSeniority &gt; otherSeniority) {</span>
<span class="fc" id="L147">            return 1;</span>
        }
<span class="fc bfc" id="L149" title="All 2 branches covered.">        else if(thisSeniority &lt; otherSeniority) {</span>
<span class="fc" id="L150">            return -1;</span>
        }
        //Same poker rankings

        //Checks for ranking with no repeating cards
<span class="pc bpc" id="L155" title="1 of 4 branches missed.">        if(IntStream.of(noMultipleCardsSeniorities).anyMatch(x -&gt; x == thisSeniority)) {</span>
            //if no repeating cards (e.g. straight, flush, straight flush), compare the highest card
<span class="fc" id="L157">            return highestCardSearch(other);</span>
        }
        //else, we have repeating cards (e.g. pair, two pairs, three of a kind, full house, four of a kind)
<span class="nc" id="L160">        return weightedHighestCardSearch(other);</span>
    }

    //--------auxiliary---------

    /**
     * Auxiliary function, sorts hand for easier comparisons
     * @param toSort
     */
    private void sortHand(Hand toSort) {
        //Just sort the hand
<span class="fc" id="L171">        toSort.hand_.sort(new Comparator&lt;Card&gt;() {</span>
            @Override
            public int compare(Card o1, Card o2) {
<span class="fc" id="L174">                return Integer.compare(o1.getRankValue(), o2.getRankValue());</span>
            }
        });
<span class="fc" id="L177">    }</span>


/* --------------------- Layout WITH NO repeating cards --------------------- */

    /**
     * Kicker comparator when there are no repeating cards. Looks for the highest card (Cards ought to already be sorted)
     * @param other
     * @return
     */
    private int highestCardSearch(Hand other) {
        // Looks for the highest card (Cards ought to already be sorted)
        //Loops through the hand and returns:
        // -&gt; 1:   if this hand has the highest card
        // -&gt; -1:  if the other hand has the highest card
        // -&gt; 0:   if they are equal

<span class="fc bfc" id="L194" title="All 2 branches covered.">        for(int i=0; i&lt;numberOfCards_; i++) {</span>
<span class="fc bfc" id="L195" title="All 2 branches covered.">            if(this.hand_.get(i).getRankValue() &gt; other.hand_.get(i).getRankValue()) {</span>
<span class="fc" id="L196">                return 1;</span>
<span class="fc bfc" id="L197" title="All 2 branches covered.">            } else if(this.hand_.get(i).getRankValue() &lt; other.hand_.get(i).getRankValue()) {</span>
<span class="fc" id="L198">                return -1;</span>
            }
        }
<span class="fc" id="L201">        return 0;</span>
    }



/* ----------------------- Layout WITH repeating cards ---------------------- */

    /**
     * Kicker comparator when there are repeating cards. Looks for the highest card (Cards ought to already be sorted)
     * @param other
     * @return
     */
    private int weightedHighestCardSearch(Hand other) {
<span class="nc" id="L214">        int[][] thisHand = handTo2dArray(this);</span>
<span class="nc" id="L215">        int[][] otherHand = handTo2dArray(other);</span>

<span class="nc bnc" id="L217" title="All 2 branches missed.">        for(int i=0; i&lt;numberOfCards_; i++) {</span>
<span class="nc bnc" id="L218" title="All 2 branches missed.">            if(thisHand[i][0] &gt; otherHand[i][0]) {</span>
<span class="nc" id="L219">                return 1;</span>
<span class="nc bnc" id="L220" title="All 2 branches missed.">            } else if(thisHand[i][0] &lt; otherHand[i][0]) {</span>
<span class="nc" id="L221">                return -1;</span>
            }
        }
<span class="nc" id="L224">        return 0;</span>
    }

    //    --------auxiliary---------

    /**
     * Auxiliary function counting occurances and weights of cards and putting it in 2d array
     * @param other
     * @return
     */
    private int[][] handTo2dArray(Hand other) {
        /*
        Returns given Hand in form of an array of cards with their weights -&gt; [cardValue, weight].
        For example if we have a hand &quot;A J 4 4 2&quot; the representation is:
        [4, 2]
        [15, 1]
        [11, 1]
        [2, 1]
        [0, 0]
        There are always 5 rows and 2 columns (numbers in column 1 always add up to 5).
        Example &quot;Q Q Q 7 7&quot;:
        [12, 3]
        [7, 2]
        [0, 0]
        [0, 0]
        [0, 0]
         */
<span class="nc" id="L251">        int[] cards = new int[13];</span>
<span class="nc" id="L252">        int[][] result = new int[5][2];</span>

<span class="nc bnc" id="L254" title="All 2 branches missed.">        for (int i = 0; i &lt; numberOfCards_; i++) {</span>
<span class="nc" id="L255">            cards[other.hand_.get(i).getRankValue()-2] += 1;</span>
        }


<span class="nc bnc" id="L259" title="All 2 branches missed.">        for(int i=0, j=0; i&lt;13; i++) {</span>
            //if there is a card with value i+2
<span class="nc bnc" id="L261" title="All 2 branches missed.">            if(cards[i] &gt; 0) {</span>
<span class="nc" id="L262">                result[j][0] = i;</span>
<span class="nc" id="L263">                result[j++][1] = cards[i];</span>
            }
        }
<span class="nc" id="L266">        RowsSort(result);</span>
<span class="nc" id="L267">        return result;</span>
    }

    /**
     * Auxiliary function sorting 2d card arrays
     * @param arr
     */
    static void RowsSort(int arr[][]) {
<span class="nc" id="L275">        Arrays.sort(arr, new Comparator&lt;int[]&gt;() {</span>
            public int compare(int[] first, int[] second) {
<span class="nc bnc" id="L277" title="All 2 branches missed.">                if(first[1]*100+first[0] &lt; second[1]*100+second[0]) {</span>
<span class="nc" id="L278">                    return 1;</span>
                }
<span class="nc" id="L280">                else return -1;</span>
            }
        });
<span class="nc" id="L283">    }</span>


    /* ---------------------- Seniority deciding functions ---------------------- */
    //Hand seniority returns int - meaning poker hand rankings

    /**
     * Hand seniority returns int - meaning poker hand rankings
     * Function looks for known card layouts. First thing we ought to start when comparing two hands.
     * @return
     */
    private int handSeniority() {
<span class="fc" id="L295">        return allCardsInTheSameColor() + allCardsInConsecutiveOrder() + multipleCards();</span>
    }

    //    --------auxiliary---------
    private int allCardsInTheSameColor() {
        //Checks if all cards are of the same color
<span class="fc bfc" id="L301" title="All 2 branches covered.">        for (Card i : hand_) {</span>
<span class="fc bfc" id="L302" title="All 2 branches covered.">            if (hand_.get(0).getSuit() != i.getSuit())</span>
<span class="fc" id="L303">                return noSeniority;</span>
<span class="fc" id="L304">        }</span>
<span class="fc" id="L305">        return flushSeniority;</span>
    }
    private int allCardsInConsecutiveOrder() {
        //Checks if all cards are in 'straight' order (one after another)
<span class="pc bpc" id="L309" title="1 of 2 branches missed.">        for (int i = 1; i &lt; numberOfCards_; i++) {</span>
<span class="pc bpc" id="L310" title="1 of 2 branches missed.">            if (hand_.get(i-1).getRankValue()-1 != hand_.get(i).getRankValue()) {</span>
<span class="fc" id="L311">                return noSeniority;</span>
            }
        }
<span class="nc" id="L314">        return straightSeniority;</span>
    }
    private int multipleCards() {
<span class="fc" id="L317">        int[] cards = new int[13];</span>
<span class="fc" id="L318">        int[] givenHandSeniority = new int[5];</span>

<span class="fc bfc" id="L320" title="All 2 branches covered.">        for (int i = 0; i &lt; numberOfCards_; i++) {</span>
<span class="fc" id="L321">            cards[hand_.get(i).getRankValue()-2] += 1;</span>
        }

<span class="fc bfc" id="L324" title="All 2 branches covered.">        for(int i=0, j=0; i&lt;13; i++) {</span>
<span class="fc bfc" id="L325" title="All 2 branches covered.">            if(cards[i] &gt; 0) {</span>
<span class="fc" id="L326">                givenHandSeniority[j++] = cards[i];</span>
            }
        }

<span class="fc" id="L330">        Arrays.sort(givenHandSeniority);</span>

<span class="pc bpc" id="L332" title="1 of 2 branches missed.">        if (Arrays.equals(givenHandSeniority, pairArray)) {</span>
<span class="nc" id="L333">            return pairSeniority;</span>
        }
<span class="pc bpc" id="L335" title="1 of 2 branches missed.">        else if(Arrays.equals(givenHandSeniority, twoPairsArray)) {</span>
<span class="nc" id="L336">            return twoPairsSeniority;</span>
        }
<span class="pc bpc" id="L338" title="1 of 2 branches missed.">        else if(Arrays.equals(givenHandSeniority, threeSameArray)) {</span>
<span class="nc" id="L339">            return threeOfTheKindSeniority;</span>
<span class="pc bpc" id="L340" title="1 of 2 branches missed.">        } else if(Arrays.equals(givenHandSeniority, fullHouseArray)) {</span>
<span class="nc" id="L341">            return fullHouseSeniority;</span>
        }
<span class="pc bpc" id="L343" title="1 of 2 branches missed.">        else if(Arrays.equals(givenHandSeniority, fourSameArray)) {</span>
<span class="nc" id="L344">            return fourOfTheKindSeniority;</span>
        }
<span class="fc" id="L346">        return noSeniority;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>